<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Hospital Admin Dashboard</title>
<style>
body { font-family: Arial, sans-serif; background:#f4f4f4; margin:0; padding:0; }
header { background:#e63946; color:white; padding:15px; text-align:center; }
header h2 { margin:0; }
.container { padding:20px; max-width:1000px; margin:auto; }
section { margin-bottom:30px; background:white; padding:20px; border-radius:10px; box-shadow:0 2px 6px rgba(0,0,0,0.1);}
h3 { color:#e63946; }
table { width:100%; border-collapse:collapse; margin-top:15px; }
th, td { padding:10px; border:1px solid #ddd; text-align:center; }
th { background:#e63946; color:white; }
button { padding:8px 15px; border:none; border-radius:5px; cursor:pointer; background:#e63946; color:white; }
button:hover { background:#c92f3d; }
input[type=number] { width:70px; padding:5px; }
</style>
</head>
<body>

<header>
<h2>Hospital Admin Dashboard</h2>
</header>
<nav>
  <a href="hospital-dashboard.html">Dashboard</a> | Admin Panel
</nav>

<div class="container">
  <section>
    <h3>Blood Inventory</h3>
    <table id="bloodTable">
      <tr>
        <th>Blood Type</th>
        <th>Units</th>
        <th>Update Units</th>
      </tr>
      <!-- Dynamically filled -->
    </table>
  </section>

  <section>
    <h3>Add Donation</h3>
    <form id="addDonationForm">
      <label>Donor Name:</label>
      <input type="text" id="donorName" required>
      <label>Blood Type:</label>
      <select id="donorBlood" required>
        <option>O+</option><option>O-</option><option>A+</option><option>A-</option>
        <option>B+</option><option>B-</option><option>AB+</option><option>AB-</option>
      </select>
      <label>Units Donated:</label>
      <input type="number" id="donatedUnits" min="1" required>
      <button type="submit">Add Donation</button>
    </form>
  </section>

  <section>
    <h3>Summary Stats</h3>
    <p id="summaryStats">Total Units: 0 | Total Donations: 0</p>
  </section>
</div>

<script>
let hospitalBlood = JSON.parse(localStorage.getItem('blood') || '[]');
let totalDonations = 0;

function renderBloodTable() {
  const table = document.getElementById('bloodTable');
  table.innerHTML = `<tr>
    <th>Blood Type</th>
    <th>Units</th>
    <th>Update Units</th>
  </tr>`;
  hospitalBlood.forEach((b, idx) => {
    const row = table.insertRow();
    row.insertCell().innerText = b.type;
    row.insertCell().innerText = b.units;
    const updateCell = row.insertCell();
    const input = document.createElement('input');
    input.type = 'number';
    input.value = b.units;
    input.min = 0;
    input.addEventListener('change', e => {
      hospitalBlood[idx].units = parseInt(e.target.value);
      localStorage.setItem('blood', JSON.stringify(hospitalBlood));
      updateSummary();
    });
    updateCell.appendChild(input);
  });
}
const token = localStorage.getItem("token");
const isAdmin = JSON.parse(localStorage.getItem("isAdmin") || "false");

if (isAdmin) {
  const adminBtn = document.createElement("button");
  adminBtn.innerText = "Admin Panel";
  adminBtn.onclick = () => { window.location.href = "hospital-admin.html"; };
  document.body.prepend(adminBtn);
}

function updateSummary() {
  const totalUnits = hospitalBlood.reduce((sum,b) => sum + b.units, 0);
  document.getElementById('summaryStats').innerText = `Total Units: ${totalUnits} | Total Donations: ${totalDonations}`;
}

document.getElementById('addDonationForm').addEventListener('submit', e => {
  e.preventDefault();
  const donorName = document.getElementById('donorName').value;
  const bloodType = document.getElementById('donorBlood').value;
  const units = parseInt(document.getElementById('donatedUnits').value);

  const bloodObj = hospitalBlood.find(b => b.type === bloodType);
  if(bloodObj) bloodObj.units += units;
  else hospitalBlood.push({type:bloodType, units:units});
  totalDonations += units;

  localStorage.setItem('blood', JSON.stringify(hospitalBlood));
  renderBloodTable();
  updateSummary();

  document.getElementById('addDonationForm').reset();
});

renderBloodTable();
updateSummary();
</script>

</body>
</html>
